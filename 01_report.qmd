---
subtitle: "Updated: `r format(Sys.Date(), '%B %d, %Y')`"
title-block-banner: "#EEF3F6"
title-block-banner-color: "#040548"
resource_files:
- data/churn.csv
- images/logo.png
- 03_email.Rmd
- custom.css
---

```{r}
library(knitr)
library(blastula)

# Day and time to send email report
email_day <- "Tue"
email_hour <- 7
```

```{r}
htmltools::img(
  src = knitr::image_uri("images/logo.png"), 
  alt = 'logo', 
  style = 'position:absolute; top:0; right:0; padding:30px; width:220px; height:220px'
)
```

```{r, results='asis'}
report_body <- knit_child("02_body.qmd", quiet = TRUE)
cat(report_body, sep= "\n")
```

```{r connect-email}
# Send the report email once a week
day <- lubridate::wday(Sys.Date(), label = TRUE)
hour <- lubridate::hour(Sys.time())

if (day == email_day & hour == email_hour) {
  render_connect_email(input = "03_em ail.Rmd") |>
    attach_connect_email(subject = "Weekly update: Customer churn")
} else {
  suppress_scheduled_email()
}
```
